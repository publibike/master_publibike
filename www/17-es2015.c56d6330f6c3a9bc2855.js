(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{zbjN:function(t,i,e){"use strict";e.r(i),e.d(i,"RutePageModuleNgFactory",(function(){return f}));var s=e("8Y7J");class n{}var o=e("pMnS"),l=e("MKJQ"),a=e("sZkV"),r=e("mrSG"),c=e("r6rm");class u{constructor(t,i,e){this.apiService=t,this.storage=i,this.loadingCtrl=e,this._zoom=10,this._center=[-74.090923,4.694939],this._basemap="streets-vector",this._loaded=!1,this._view=null,this._locator=null,this._locate=null,this._search=null,this._track=null,this._pointGC=null,this._draw=null,this._distance=null,this.horas=0,this.centesimas=0,this.minutos=59,this.segundos=0,this._centesimas="00",this._minutos="00",this._segundos="00",this._horas="00",this.isRun=!1,this.recorrido=[],this.user={nombre:"",apellido:"",ganancia_total:0,km_total:0,cal_total:0,co2_total:0},this.ruteData={},this.km=0,this.ingresos=0,this.cal=0,this.co2=0}initializedMap(){return Object(r.a)(this,void 0,void 0,(function*(){try{const[i,e,s,n,o,l,a,r,u,h,d,g,p,_,m,v,b,w]=yield Object(c.loadModules)(["esri/Map","esri/views/MapView","esri/Graphic","esri/tasks/RouteTask","esri/tasks/support/RouteParameters","esri/tasks/support/FeatureSet","esri/widgets/Directions","esri/widgets/Locate","esri/widgets/Track","esri/tasks/Locator","esri/widgets/Search","esri/widgets/Expand","esri/widgets/Legend","esri/geometry/Point","esri/views/draw/Draw","esri/geometry/geometryEngine","esri/layers/FeatureLayer","esri/widgets/DistanceMeasurement2D/DistanceMeasurement2DViewModel"]);let C=new i({basemap:this._basemap});this._view=new e({container:this.mapEl.nativeElement,center:this._center,zoom:this._zoom,map:C});const f=new b({url:"https://services2.arcgis.com/NEwhEo9GGSHXcRXV/arcgis/rest/services/Cicloparqueaderos_Certificados_Bogota_D_C/FeatureServer/0",outFields:["*"],popupTemplate:{title:"Cicloparqueadero",content:[{type:"fields",fieldInfos:[{fieldName:"COD_CICP",visible:!1,label:"Codigo_Cicloparqueadero"},{fieldName:"NOMBRE_CICP",visible:!0,label:"Nombre"},{fieldName:"HORARIO_CICP",visible:!0,label:"Horario"},{fieldName:"DIRECCION",visible:!0,label:"Direcci\xf3n"},{fieldName:"LOCALIDAD",visible:!0,label:"Localidad"},{fieldName:"CUPOS",visible:!0,label:"Cupos"},{fieldName:"TIPOLOGIA_CICP",visible:!0,label:"Servicio"},{fieldName:"SELLO",visible:!1,label:"SELLO_TIPO"}]}]}});C.add(f);const k=new b({url:"https://serviciosgis.catastrobogota.gov.co/arcgis/rest/services/movilidad/cicloparqueadero/MapServer"});C.add(k);var t=new p({view:this._view,layerInfos:[{layer:f,title:"Categoria Cicloparqueaderos"}]});let O=new g({view:this._view,content:t,autoCollapse:!1});this._view.ui.add(O,"bottom-right"),this._search=new d({view:this._view}),this._view.ui.add(this._search,{position:"top-left",index:0}),this._locator=new h({url:"https://utility.arcgis.com/usrsvcs/appservices/rdJwJijx0YBycNdS/rest/services/World/GeocodeServer/reverseGeocode"}),this._locate=new r({view:this._view,useHeadingEnabled:!1,goToOverride:function(t,i){return i.target.scale=1500,t.goTo(i.target)}}),this._view.ui.add(this._locate,{position:"top-left",index:2}),this._pointGC=new _,this._draw=new m({view:this._view}),this._track=new u({view:this._view,graphic:new s({symbol:{type:"simple-marker",size:"12px",color:"green",outline:{color:"#efefef",width:"1.5px"}}}),useHeadingEnabled:!0,goToOverride:function(t,i){return i.target.scale=1500,t.goTo(i.target)}}),this._distance=new w({view:this._view,unit:"kilometers"}),new n({url:"https://sig.simur.gov.co/arcgis/rest/services/MVI_REDBICI/NARedBici/NAServer/Principiante"});let y=new a({view:this._view,routeServiceUrl:"https://sig.simur.gov.co/arcgis/rest/services/MVI_REDBICI/NARedBici/NAServer/Principiante"}),G=new g({view:this._view,content:y,autoCollapse:!1});return this._view.ui.add(G,"top-right"),yield this._view.when(),this._view}catch(i){console.log(i)}}))}ngOnInit(){return Object(r.a)(this,void 0,void 0,(function*(){this.presentLoading(),this.user=yield this.storage.get("userData"),this.initializedMap().then(t=>Object(r.a)(this,void 0,void 0,(function*(){console.log("mapView ready: ",this._view.ready),this._loaded=this._view.ready,this.loading.dismiss()})))}))}startRute(){return Object(r.a)(this,void 0,void 0,(function*(){this.clearWindows(),this._track.start(),yield this._distance.start(),console.log(this._distance);const t=new Date;let i;this.fecha=t,console.log(this.fecha);let e=yield this._locate.locate();this._pointGC.latitude=e.coords.latitude,this._pointGC.longitude=e.coords.longitude;let s={location:this._pointGC};this._track.on("track",t=>Object(r.a)(this,void 0,void 0,(function*(){this.recorrido.push(t);let i=this.recorrido.length-1;this.recorrido.length>1&&(this.km=this.calculateDistance(this.recorrido[0].position.coords.longitude,this.recorrido[i].position.coords.longitude,this.recorrido[0].position.coords.latitude,this.recorrido[i].position.coords.latitude),console.log(this.km))}))),this._locator.locationToAddress(s).then(t=>{i=t.address,console.log(i),i=i.split(","),this.fstDirection=i[0]}).catch(t=>console.log(t)),this.contador=setInterval(()=>{this.centesimas+=1,this._centesimas=this.centesimas<10?"0"+this.centesimas:""+this.centesimas,10==this.centesimas&&(this.centesimas=0,this.segundos+=1,this._segundos=this.segundos<10?"0"+this.segundos:this.segundos+"",60==this.segundos&&(this.segundos=0,this.minutos+=1,this._minutos=this.minutos<10?"0"+this.minutos:this.minutos+"",this._segundos="00",60==this.minutos&&(this.minutos=0,this.minutos+=1,this._horas=this.horas<10?"0"+this.horas:this.horas+"",this._minutos="00")))},100)}))}stopRute(){return Object(r.a)(this,void 0,void 0,(function*(){try{if(!this.isRun){let t;this._track.stop(),this.time=`${this._horas}:${this._minutos}:${this._segundos}.${this._centesimas}`,clearInterval(this.contador),this.isRun=!1;let i=yield this._locate.locate();this._pointGC.latitude=i.coords.latitude,this._pointGC.longitude=i.coords.longitude,this._locator.locationToAddress({location:this._pointGC}).then(i=>{t=i.address,console.log(t),t=t.split(","),this.fnlDirection=t[0];let e=parseFloat(this.km);this.co2=(.3*e).toFixed(3),console.log("co2",typeof e,this.co2),this.ruteData={fecha:this.fecha,inicio:this.fstDirection,final:this.fnlDirection,tiempo:this.time,kms:this.km,cal:this.cal,co2:this.co2,ingresos:this.ingresos},console.log(this.ruteData),this.apiService.sendRute(this.ruteData)}).catch(t=>console.log(t))}}catch(t){console.log(t)}}))}calculateDistance(t,i,e,s){let n=.017453292519943295,o=Math.cos,l=.5-o((e-s)*n)/2+o(s*n)*o(e*n)*(1-o((t-i)*n))/2;return(12742*Math.asin(Math.sqrt(l))).toFixed(2)}clearWindows(){this.minutos=0,this.segundos=0,this.centesimas=0,this.horas=0,this._centesimas="00",this._segundos="00",this._minutos="00",this._horas="00",this.km=0}presentLoading(){return Object(r.a)(this,void 0,void 0,(function*(){this.loading=yield this.loadingCtrl.create({cssClass:"my-custom-class",message:"Cargando..."}),yield this.loading.present()}))}getIconByStatus(t){let i="";switch(t){case"true":i="button-stop-29.png";break;case"false":i="button-start-29.png"}return i}}var h=e("N/ei"),d=e("xgBC"),g=s.sb({encapsulation:0,styles:[[".logo-ekobike-in[_ngcontent-%COMP%]{position:unset;margin-bottom:30px;margin-top:20px}.content-map[_ngcontent-%COMP%]{height:100%}#viewDiv[_ngcontent-%COMP%]{padding:0;margin:0;height:400px;width:100%}.esri-view-width-xsmall[_ngcontent-%COMP%]   .esri-expand--auto[_ngcontent-%COMP%]   .esri-expand__container--expanded[_ngcontent-%COMP%]{height:34%;background:#001434}.esri-widget--button[_ngcontent-%COMP%]{background-color:#f9b410!important;color:#001434!important}.esri-view[_ngcontent-%COMP%]   .esri-directions[_ngcontent-%COMP%]{position:fixed;right:15px}.esri-view[_ngcontent-%COMP%]   .esri-component.esri-attribution[_ngcontent-%COMP%]{position:fixed}.esri-search__suggestions-list[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{padding:1em}"]],data:{}});function p(t){return s.Ub(0,[s.Nb(671088640,1,{mapEl:0}),(t()(),s.ub(1,0,null,null,9,"ion-content",[],null,null,null,l.x,l.e)),s.tb(2,49152,null,0,a.s,[s.h,s.l,s.z],null,null),(t()(),s.ub(3,0,null,0,1,"div",[["class","logo-ekobike-in"]],null,null,null,null,null)),(t()(),s.ub(4,0,null,null,0,"img",[["src","assets/img/logo-ekobike.png"]],null,null,null,null,null)),(t()(),s.ub(5,0,null,0,5,"div",[["class","content-map"]],null,null,null,null,null)),(t()(),s.ub(6,0,null,null,3,"div",[["class","ui grid content-play"]],null,null,null,null,null)),(t()(),s.ub(7,0,null,null,2,"div",[["class","column distance"]],null,null,null,null,null)),(t()(),s.ub(8,0,null,null,1,"h4",[],null,null,null,null,null)),(t()(),s.Rb(-1,null,["Explora"])),(t()(),s.ub(10,0,[[1,0],["map",1]],null,0,"div",[["id","viewDiv"]],null,null,null,null,null))],null,null)}function _(t){return s.Ub(0,[(t()(),s.ub(0,0,null,null,1,"app-rute",[],null,null,null,p,g)),s.tb(1,114688,null,0,u,[h.a,d.b,a.Bb],null,null)],(function(t,i){t(i,1,0)}),null)}var m=s.qb("app-rute",u,_,{},{},[]),v=e("SVse"),b=e("s7LF"),w=e("iInd");class C{}var f=s.rb(n,[],(function(t){return s.Fb([s.Gb(512,s.j,s.W,[[8,[o.a,m]],[3,s.j],s.x]),s.Gb(4608,v.l,v.k,[s.u]),s.Gb(4608,b.n,b.n,[]),s.Gb(4608,a.b,a.b,[s.z,s.g]),s.Gb(4608,a.Cb,a.Cb,[a.b,s.j,s.r]),s.Gb(4608,a.Gb,a.Gb,[a.b,s.j,s.r]),s.Gb(1073742336,v.b,v.b,[]),s.Gb(1073742336,b.m,b.m,[]),s.Gb(1073742336,b.f,b.f,[]),s.Gb(1073742336,a.zb,a.zb,[]),s.Gb(1073742336,w.n,w.n,[[2,w.s],[2,w.m]]),s.Gb(1073742336,C,C,[]),s.Gb(1073742336,n,n,[]),s.Gb(1024,w.k,(function(){return[[{path:"",component:u}]]}),[])])}))}}]);