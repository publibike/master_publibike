!function(){function e(e,i){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],n=!0,s=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(i.push(o.value),!t||i.length!==t);n=!0);}catch(l){s=!0,r=l}finally{try{n||null==a.return||a.return()}finally{if(s)throw r}}return i}(e,i)||function(e,i){if(!e)return;if("string"==typeof e)return t(e,i);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t(e,i)}(e,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{zbjN:function(t,s,r){"use strict";r.r(s),r.d(s,"RutePageModuleNgFactory",(function(){return y}));var o=r("8Y7J"),a=function e(){n(this,e)},l=r("pMnS"),c=r("MKJQ"),u=r("sZkV"),h=r("mrSG"),d=r("r6rm"),g=function(){function t(e,i,s){n(this,t),this.apiService=e,this.storage=i,this.loadingCtrl=s,this._zoom=10,this._center=[-74.090923,4.694939],this._basemap="streets-vector",this._loaded=!1,this._view=null,this._locator=null,this._locate=null,this._search=null,this._track=null,this._pointGC=null,this._draw=null,this._distance=null,this.horas=0,this.centesimas=0,this.minutos=59,this.segundos=0,this._centesimas="00",this._minutos="00",this._segundos="00",this._horas="00",this.isRun=!1,this.recorrido=[],this.user={nombre:"",apellido:"",ganancia_total:0,km_total:0,cal_total:0,co2_total:0},this.ruteData={},this.km=0,this.ingresos=0,this.cal=0,this.co2=0}var s,r,o;return s=t,(r=[{key:"initializedMap",value:function(){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var i,n,s,r,o,a,l,c,u,h,g,p,m,v,b,f,_,w,C,k,y,x,O,R;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(d.loadModules)(["esri/Map","esri/views/MapView","esri/Graphic","esri/tasks/RouteTask","esri/tasks/support/RouteParameters","esri/tasks/support/FeatureSet","esri/widgets/Directions","esri/widgets/Locate","esri/widgets/Track","esri/tasks/Locator","esri/widgets/Search","esri/widgets/Expand","esri/widgets/Legend","esri/geometry/Point","esri/views/draw/Draw","esri/geometry/geometryEngine","esri/layers/FeatureLayer","esri/widgets/DistanceMeasurement2D/DistanceMeasurement2DViewModel"]);case 3:return i=t.sent,n=e(i,18),s=n[0],r=n[1],o=n[2],a=n[3],n[4],n[5],l=n[6],c=n[7],u=n[8],h=n[9],g=n[10],p=n[11],m=n[12],v=n[13],b=n[14],n[15],f=n[16],_=n[17],w=new s({basemap:this._basemap}),this._view=new r({container:this.mapEl.nativeElement,center:this._center,zoom:this._zoom,map:w}),C=new f({url:"https://services2.arcgis.com/NEwhEo9GGSHXcRXV/arcgis/rest/services/Cicloparqueaderos_Certificados_Bogota_D_C/FeatureServer/0",outFields:["*"],popupTemplate:{title:"Cicloparqueadero",content:[{type:"fields",fieldInfos:[{fieldName:"COD_CICP",visible:!1,label:"Codigo_Cicloparqueadero"},{fieldName:"NOMBRE_CICP",visible:!0,label:"Nombre"},{fieldName:"HORARIO_CICP",visible:!0,label:"Horario"},{fieldName:"DIRECCION",visible:!0,label:"Direcci\xf3n"},{fieldName:"LOCALIDAD",visible:!0,label:"Localidad"},{fieldName:"CUPOS",visible:!0,label:"Cupos"},{fieldName:"TIPOLOGIA_CICP",visible:!0,label:"Servicio"},{fieldName:"SELLO",visible:!1,label:"SELLO_TIPO"}]}]}}),w.add(C),k=new f({url:"https://serviciosgis.catastrobogota.gov.co/arcgis/rest/services/movilidad/cicloparqueadero/MapServer"}),w.add(k),y=new m({view:this._view,layerInfos:[{layer:C,title:"Categoria Cicloparqueaderos"}]}),x=new p({view:this._view,content:y,autoCollapse:!1}),this._view.ui.add(x,"bottom-right"),this._search=new g({view:this._view}),this._view.ui.add(this._search,{position:"top-left",index:0}),this._locator=new h({url:"https://utility.arcgis.com/usrsvcs/appservices/rdJwJijx0YBycNdS/rest/services/World/GeocodeServer/reverseGeocode"}),this._locate=new c({view:this._view,useHeadingEnabled:!1,goToOverride:function(e,t){return t.target.scale=1500,e.goTo(t.target)}}),this._view.ui.add(this._locate,{position:"top-left",index:2}),this._pointGC=new v,this._draw=new b({view:this._view}),this._track=new u({view:this._view,graphic:new o({symbol:{type:"simple-marker",size:"12px",color:"green",outline:{color:"#efefef",width:"1.5px"}}}),useHeadingEnabled:!0,goToOverride:function(e,t){return t.target.scale=1500,e.goTo(t.target)}}),this._distance=new _({view:this._view,unit:"kilometers"}),new a({url:"https://sig.simur.gov.co/arcgis/rest/services/MVI_REDBICI/NARedBici/NAServer/Principiante"}),O=new l({view:this._view,routeServiceUrl:"https://sig.simur.gov.co/arcgis/rest/services/MVI_REDBICI/NARedBici/NAServer/Principiante"}),R=new p({view:this._view,content:O,autoCollapse:!1}),this._view.ui.add(R,"top-right"),t.next=36,this._view.when();case 36:return t.abrupt("return",this._view);case 39:t.prev=39,t.t0=t.catch(0),console.log(t.t0);case 42:case"end":return t.stop()}}),t,this,[[0,39]])})))}},{key:"ngOnInit",value:function(){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.presentLoading(),e.next=3,this.storage.get("userData");case 3:this.user=e.sent,this.initializedMap().then((function(e){return Object(h.a)(t,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("mapView ready: ",this._view.ready),this._loaded=this._view.ready,this.loading.dismiss();case 1:case"end":return e.stop()}}),e,this)})))}));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"startRute",value:function(){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,i,n,s,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.clearWindows(),this._track.start(),e.next=4,this._distance.start();case 4:return console.log(this._distance),t=new Date,this.fecha=t,console.log(this.fecha),e.next=9,this._locate.locate();case 9:n=e.sent,this._pointGC.latitude=n.coords.latitude,this._pointGC.longitude=n.coords.longitude,s={location:this._pointGC},this._track.on("track",(function(e){return Object(h.a)(r,void 0,void 0,regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.recorrido.push(e),i=this.recorrido.length-1,this.recorrido.length>1&&(this.km=this.calculateDistance(this.recorrido[0].position.coords.longitude,this.recorrido[i].position.coords.longitude,this.recorrido[0].position.coords.latitude,this.recorrido[i].position.coords.latitude),console.log(this.km));case 3:case"end":return t.stop()}}),t,this)})))})),this._locator.locationToAddress(s).then((function(e){i=e.address,console.log(i),i=i.split(","),r.fstDirection=i[0]})).catch((function(e){return console.log(e)})),this.contador=setInterval((function(){r.centesimas+=1,r._centesimas=r.centesimas<10?"0"+r.centesimas:""+r.centesimas,10==r.centesimas&&(r.centesimas=0,r.segundos+=1,r._segundos=r.segundos<10?"0"+r.segundos:r.segundos+"",60==r.segundos&&(r.segundos=0,r.minutos+=1,r._minutos=r.minutos<10?"0"+r.minutos:r.minutos+"",r._segundos="00",60==r.minutos&&(r.minutos=0,r.minutos+=1,r._horas=r.horas<10?"0"+r.horas:r.horas+"",r._minutos="00")))}),100);case 13:case"end":return e.stop()}}),e,this)})))}},{key:"stopRute",value:function(){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,i,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.isRun){e.next=7;break}return this._track.stop(),this.time="".concat(this._horas,":").concat(this._minutos,":").concat(this._segundos,".").concat(this._centesimas),clearInterval(this.contador),this.isRun=!1,e.next=5,this._locate.locate();case 5:i=e.sent,this._pointGC.latitude=i.coords.latitude,this._pointGC.longitude=i.coords.longitude,this._locator.locationToAddress({location:this._pointGC}).then((function(e){t=e.address,console.log(t),t=t.split(","),n.fnlDirection=t[0];var i=parseFloat(n.km);n.co2=(.3*i).toFixed(3),console.log("co2",typeof i,n.co2),n.ruteData={fecha:n.fecha,inicio:n.fstDirection,final:n.fnlDirection,tiempo:n.time,kms:n.km,cal:n.cal,co2:n.co2,ingresos:n.ingresos},console.log(n.ruteData),n.apiService.sendRute(n.ruteData)})).catch((function(e){return console.log(e)}));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0);case 12:case"end":return e.stop()}}),e,this,[[0,9]])})))}},{key:"calculateDistance",value:function(e,t,i,n){var s=.017453292519943295,r=Math.cos,o=.5-r((i-n)*s)/2+r(n*s)*r(i*s)*(1-r((e-t)*s))/2;return(12742*Math.asin(Math.sqrt(o))).toFixed(2)}},{key:"clearWindows",value:function(){this.minutos=0,this.segundos=0,this.centesimas=0,this.horas=0,this._centesimas="00",this._segundos="00",this._minutos="00",this._horas="00",this.km=0}},{key:"presentLoading",value:function(){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadingCtrl.create({cssClass:"my-custom-class",message:"Cargando..."});case 2:return this.loading=e.sent,e.next=5,this.loading.present();case 5:case"end":return e.stop()}}),e,this)})))}},{key:"getIconByStatus",value:function(e){var t="";switch(e){case"true":t="button-stop-29.png";break;case"false":t="button-start-29.png"}return t}}])&&i(s.prototype,r),o&&i(s,o),t}(),p=r("N/ei"),m=r("xgBC"),v=o.sb({encapsulation:0,styles:[[".logo-ekobike-in[_ngcontent-%COMP%]{position:unset;margin-bottom:30px;margin-top:20px}.content-map[_ngcontent-%COMP%]{height:100%}#viewDiv[_ngcontent-%COMP%]{padding:0;margin:0;height:400px;width:100%}.esri-view-width-xsmall[_ngcontent-%COMP%]   .esri-expand--auto[_ngcontent-%COMP%]   .esri-expand__container--expanded[_ngcontent-%COMP%]{height:34%;background:#001434}.esri-widget--button[_ngcontent-%COMP%]{background-color:#f9b410!important;color:#001434!important}.esri-view[_ngcontent-%COMP%]   .esri-directions[_ngcontent-%COMP%]{position:fixed;right:15px}.esri-view[_ngcontent-%COMP%]   .esri-component.esri-attribution[_ngcontent-%COMP%]{position:fixed}.esri-search__suggestions-list[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{padding:1em}"]],data:{}});function b(e){return o.Ub(0,[o.Nb(671088640,1,{mapEl:0}),(e()(),o.ub(1,0,null,null,9,"ion-content",[],null,null,null,c.x,c.e)),o.tb(2,49152,null,0,u.s,[o.h,o.l,o.z],null,null),(e()(),o.ub(3,0,null,0,1,"div",[["class","logo-ekobike-in"]],null,null,null,null,null)),(e()(),o.ub(4,0,null,null,0,"img",[["src","assets/img/logo-ekobike.png"]],null,null,null,null,null)),(e()(),o.ub(5,0,null,0,5,"div",[["class","content-map"]],null,null,null,null,null)),(e()(),o.ub(6,0,null,null,3,"div",[["class","ui grid content-play"]],null,null,null,null,null)),(e()(),o.ub(7,0,null,null,2,"div",[["class","column distance"]],null,null,null,null,null)),(e()(),o.ub(8,0,null,null,1,"h4",[],null,null,null,null,null)),(e()(),o.Rb(-1,null,["Explora"])),(e()(),o.ub(10,0,[[1,0],["map",1]],null,0,"div",[["id","viewDiv"]],null,null,null,null,null))],null,null)}var f=o.qb("app-rute",g,(function(e){return o.Ub(0,[(e()(),o.ub(0,0,null,null,1,"app-rute",[],null,null,null,b,v)),o.tb(1,114688,null,0,g,[p.a,m.b,u.Bb],null,null)],(function(e,t){e(t,1,0)}),null)}),{},{},[]),_=r("SVse"),w=r("s7LF"),C=r("iInd"),k=function e(){n(this,e)},y=o.rb(a,[],(function(e){return o.Fb([o.Gb(512,o.j,o.W,[[8,[l.a,f]],[3,o.j],o.x]),o.Gb(4608,_.l,_.k,[o.u]),o.Gb(4608,w.n,w.n,[]),o.Gb(4608,u.b,u.b,[o.z,o.g]),o.Gb(4608,u.Cb,u.Cb,[u.b,o.j,o.r]),o.Gb(4608,u.Gb,u.Gb,[u.b,o.j,o.r]),o.Gb(1073742336,_.b,_.b,[]),o.Gb(1073742336,w.m,w.m,[]),o.Gb(1073742336,w.f,w.f,[]),o.Gb(1073742336,u.zb,u.zb,[]),o.Gb(1073742336,C.n,C.n,[[2,C.s],[2,C.m]]),o.Gb(1073742336,k,k,[]),o.Gb(1073742336,a,a,[]),o.Gb(1024,C.k,(function(){return[[{path:"",component:g}]]}),[])])}))}}])}();